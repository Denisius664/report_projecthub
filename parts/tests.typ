= Отчет о тестировании

== Проведенные типы тестов

В рамках проекта проведено ручное и юнит-тестирование API и функционала. Интеграционные тесты не реализованы.

Ручное тестирование включало:
- Проверку корректности работы CRUD-операций с проектами, пользователями, предметными областями и файлами;
- Проверку загрузки и скачивания файлов через интеграцию с MinIO;
- Валидацию данных через схемы Pydantic;
- Проверку работы механизмов аутентификации и авторизации JWT;
- Тестирование поведения фильтрации, поиска и пагинации.

Юнит-тестирование охватывало:
- Отдельные функции CRUD и бизнес-логику с использованием pytest;
- Тестирование эндпоинтов FastAPI через fastapi.testclient;
- Проверку валидности входных данных и обработки ошибок;
- Проверку авторизации и доступа к защищённым API.

== Методы тестирования

- Ручное тестирование через инструменты API-клиенты (Postman, curl);
- Наблюдение и анализ логов FastAPI/uvicorn для подтверждения корректного выполнения запросов и отсутствия ошибок;
- Юнит-тестирование с pytest и fastapi.testclient;
- Визуальные проверки корректности ответов и форматов данных.

#v(6em)

== Результаты тестирования

#figure(
  table(
    columns: (3cm, 5cm, 3cm, 4cm),
    align: (center, left, center, left),
    stroke: .5pt,
    table.header(
      [Тестируемый модуль],
      [Проверяемый функционал],
      [Результат],
      [Заметки],
    ),

    table.hline(),

    [Проекты CRUD], [
      Создание, обновление, удаление, чтение
    ],
    [Пройдены], [
      Корректная работа с базой данных и бизнес-логикой
    ],

    table.hline(),

    [Предметные области], [
      Создание, фильтрация, чтение
    ],
    [Пройдены], [
      Ошибок не выявлено
    ],

    table.hline(),

    [Файлы (загрузка/скачивание)], [
      Интеграция с MinIO, сохранение в БД
    ],
    [Пройдены с исключением], [
      Ошибка с сохранением метаданных исправлена; юнит-тесты покрывают загрузку файлов без мокирования
    ],

    table.hline(),

    [Аутентификация и авторизация], [
      JWT токены, доступность эндпоинтов
    ],
    [Проверено], [
      Безопасность в рамках требований
    ],

    table.hline(),

    [Поиск и фильтрация проектов], [
      Поиск по названию/описанию, статусу, публичности
    ],
    [Пройдены], [
      Эндпоинты работают корректно
    ],

    table.hline(),

    [Юнит-тестирование], [
      Проверка отдельных функций и валидаций и тесты FastAPI эндпоинтов через fastapi.testclient
    ],
    [Выполнено], [
      Обнаружено 3 ошибки, которые устранены
    ],
  ),
  caption: [Результаты тестирования]
)

== Обнаруженные ошибки и способы устранения

#figure(
  table(
    columns: (3cm, 6cm, 6cm),
    align: (center, left, left),
    stroke: .5pt,
    table.header(
      [Ошибка],
      [Описание],
      [Способ устранения],
    ),

    table.hline(),

    ["`bytes object has no attribute 'read'`"], [
      Передача содержимого файла напрямую в MinIO
    ], [
      Передавать объект файла с методом `.read()`
    ],

    table.hline(),

    [Отсутствие записи о файле в базе после загрузки], [
      Отсутствие вызова `db.commit()` при сохранении
    ], [
      Добавить `db.commit()` и `db.refresh()`
    ],

    table.hline(),

    [Ошибки JSON при валидации данных], [
      Некорректный JSON в теле запроса
    ], [
      Корректно экранировать строки, использовать валидный JSON
    ],

    table.hline(),

    [Ошибка `Attribute name 'metadata' is reserved`], [
      Использование зарезервированного имени поля
    ], [
      Переименовать поле `metadata` в модели
    ],

    table.hline(),

    [Юнит-тест: Неправильная обработка исключений], [
      Некоторые ошибки не корректно обрабатывались в логике API
    ], [
      Добавлена обработка исключений и проверка ошибок в тестах
    ],

    table.hline(),

    [Юнит-тест: Некорректная валидация входных данных], [
      Валидация данных была неполной для некоторых полей
    ], [
      Расширена валидация в Pydantic схемах и покрыта тестами
    ],

    table.hline(),

    [Юнит-тест: Ошибки при загрузке файлов], [
      Возникали проблемы с обработкой файлов в тестах без мокирования
    ], [
      Исправлена логика работы с файлами в тестах, корректная обработка потоков данных
    ],
  ),
  caption: [Обнаруженные ошибки и способы их устранения]
)
